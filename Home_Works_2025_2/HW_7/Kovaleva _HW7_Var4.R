###############################################
# Домашнее задание 7 по Математическим методам в биологии
# Вариант 4
# Автор: Ковалева Александра
###############################################
# Тема: Регрессионный анализ
###############################################



################################################
# 1. Загрузка и подготовка данных
################################################

# Чтение таблицы 
data <- read.csv2("Data/V_4.csv",
  stringsAsFactors = FALSE,
  fileEncoding = "UTF-8",
  check.names = FALSE
)

# Переименование столбцов для удобства
names(data) <- c("Day", "Temp", "String")

# Убираем лишние кавычки из столбца String
data$String <- gsub('^"+|"+$', '', data$String)

# Проверка первых строк
head(data$String, 3)

#################################################
# 2. Подсчёт крестиков и ноликов
#################################################

# Подсчёт крестиков ("x")
data$Crosses <- vapply(
  data$String,
  function(x) sum(strsplit(x, "")[[1]] == "x"),
  integer(1)
)

# Подсчёт ноликов ("0")
data$Zeros <- vapply(
  data$String,
  function(x) sum(strsplit(x, "")[[1]] == "0"),
  integer(1)
)

# Проверка
head(data[, c("String", "Crosses", "Zeros")])

#################################################
# 3. Линейная модель
#################################################

model <- lm(Crosses ~ Zeros + Temp, data = data)
summary(model)

#################################################
# 4. Диагностика модели
#################################################
par(mfrow = c(2,2))
plot(model)

#################################################
# 5. Визуализация зависимости
#################################################

library(ggplot2)

ggplot(data, aes(Zeros, Crosses, color = Temp)) +
  geom_point(size = 3) +
  scale_color_gradient(low = "blue", high = "red") +
  labs(
    title = "Зависимость численности крестиков от ноликов и температуры",
    x = "Численность ноликов",
    y = "Численность крестиков",
    color = "Температура"
  ) +
  theme_minimal()

#################################################
# 6. Описание результатов
#################################################

# Результаты показывают:
# Основной фактор: количество ноликов. С его увеличением
# численность крестиков растет почти линейно (коэффициент ~0.98, p < 0.001).
# Влияние температуры отрицательное, но статистически
# незначимое (коэффициент ~ -0.06, p > 0.1).
# 
# Модель объясняет более 92% вариации численности крестиков,
# остатки нормальные, гомоскедастичность соблюдена,
# выбросов нет. Следовательно, модель адекватна для описания
# зависимости численности крестиков от изученных факторов.