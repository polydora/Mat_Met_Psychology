###############################################
# Домашнее задание 4 по Математическим методам в биологии
# Вариант 3
# Автор: Ковалева Александра
###############################################
# Тема: Тестирования статистических гипотез с помощью t-критерия Стьюдента
# Сравним рост эльфов и рост загадочных фигур при помощи двухвыборочного t-теста.
###############################################

# Создаем данные
elves <- c(180, 184, 175, 186, 178, 173, 190, 187, 178, 185, 184, 182, 178, 186, 177)
figures <- c(143, 156, 165, 138, 141, 150, 142, 146, 146, 144, 147, 152, 154, 142, 140, 142, 153, 161, 149, 154)

# Формируем датафрейм
MiddleEarth <- data.frame(
  Height = c(elves, figures),
  Group = factor(c(rep("Эльфы", length(elves)),
                   rep("Фигуры", length(figures))))
)

# Проверяем, всё ли корректно создалось
head(MiddleEarth)
str(MiddleEarth)

###############################################
# Проверка пропусков
###############################################
colSums(is.na(MiddleEarth))

###############################################
# Проверяем объёмы выборок
###############################################
table(MiddleEarth$Group)

# объёмы выборок разные (15 и 20 наблюдений).

###############################################
# Проверяем условия применимости t-теста
###############################################

# 1. Наблюдения независимы?
# Да. Каждый участник (эльф или фигура) измерен независимо.

# 2. Выборки независимы?
# Да. Эльфы и фигуры — разные группы.

# 3. Проверим форму распределения (нормальность)
# При малых выборках это важно.


# Графики распределения роста в двух группах
ggplot(MiddleEarth, aes(x = Height, fill = Group)) +
  geom_density(alpha = 0.5) +
  labs(title = "Плотность распределения роста в группах",
       x = "Рост (см)", y = "Плотность") +
  theme_minimal()

###############################################
# Проверка нормальности распределений
###############################################
by(MiddleEarth$Height, MiddleEarth$Group, shapiro.test)

# По результатам Шапиро-Уилк теста p > 0.05 → нет значимых отклонений от нормальности.
# Следовательно, можно применять двухвыборочный t-тест.

###############################################
# Двухвыборочный t-тест
###############################################

tt <- t.test(x = elves,
             y = figures)

tt
###############################################
# Описание результатов
###############################################

# Средний рост эльфов: 181.5 см
# Средний рост фигур: 148.3 см
# t(32.74) = 16.08, p < 0.001

# Так как p < 0.05, нулевая гипотеза отвергается.
# Средние значения роста статистически значимо различаются:
# Эльфы значительно выше загадочных фигур (Welch Two Sample t-test).

###############################################
# График со средними и доверительными интервалами
###############################################

ggplot(MiddleEarth, aes(x = Group, y = Height, fill = Group)) +
  stat_summary(fun.data = mean_cl_normal,
               geom = "bar",
               width = 0.6,
               color = "black",
               alpha = 0.8) +
  stat_summary(fun.data = mean_cl_normal,
               geom = "errorbar",
               width = 0.2) +
  labs(title = "Сравнение среднего роста эльфов и фигур Средиземья",
       x = "Группа",
       y = "Рост (см)") +
  theme_minimal() +
  theme(legend.position = "none")

###############################################
# Интерпретация
###############################################
# По результатам теста t(32.74) = 16.08, p = 4.24e-17.
# Средние значения роста эльфов и фигур статистически значимо различаются.
# Эльфы существенно выше — значит, это, вероятно, чужие.

